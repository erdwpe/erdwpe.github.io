<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puasa Tracker 2026</title>

<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&display=swap" rel="stylesheet">

<style>

/* ================= ROOT ================= */

:root{
    --bg-gradient: linear-gradient(135deg,#e4edf2,#d6e2ea,#c7d6e0);
    --card: rgba(255,255,255,0.85);
    --text:#1c1c1c;
    --primary:#2f3e46;
    --soft-shadow:0 6px 18px rgba(0,0,0,0.08);
}

body.dark{
    --bg-gradient: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    --card: rgba(255,255,255,0.08);
    --text:#f2f2f2;
    --primary:#ffffff;
    --soft-shadow:0 8px 22px rgba(0,0,0,0.35);
}

/* ================= BODY ================= */

body{
    font-family:'IBM Plex Mono', monospace;
    background:var(--bg-gradient);
    color:var(--text);
    margin:0;
    padding:16px;
    transition:0.3s ease;
}

/* ================= CONTAINER ================= */

.container{
    max-width:900px;
    margin:auto;
}

h1{
    font-weight:700;
    font-size:20px;
    margin-bottom:16px;
}

/* ================= TOGGLE ================= */

.theme-toggle{
    position:fixed;
    top:18px;
    right:18px;
    font-size:20px;
    cursor:pointer;
    transition:0.3s ease;
}

.theme-toggle:hover{
    transform:rotate(20deg);
}

/* ================= CARD ================= */

.card{
    background:var(--card);
    border-radius:18px;
    padding:14px;
    margin-bottom:12px;
    box-shadow:var(--soft-shadow);
}
/* ================= SEARCH ================= */

.search-card h3{
    margin-bottom:12px;
}

.search-wrapper{
    display:flex;
    gap:8px;
    align-items:center;
}

.search-wrapper input{
    flex:1;
    padding:10px 14px;
    border-radius:12px;
    border:none;
    outline:none;
    font-family:inherit;
    background:rgba(0,0,0,0.05);
    transition:0.2s ease;
}

body.dark .search-wrapper input{
    background:rgba(255,255,255,0.1);
    color:white;
}

.search-wrapper input:focus{
    box-shadow:0 0 0 2px #4facfe;
}

.search-wrapper button{
    padding:10px 18px;
    border:none;
    border-radius:12px;
    font-family:inherit;
    font-weight:600;
    cursor:pointer;
    background:linear-gradient(135deg,#4facfe,#00c6ff);
    color:white;
    transition:0.2s ease;
}

.search-wrapper button:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 14px rgba(0,0,0,0.15);
}

#cityResult{
    margin-top:14px;
    font-size:14px;
}
/* ================= PROGRESS ================= */

.progress-container{
    background:rgba(255,255,255,0.2);
    border-radius:20px;
    overflow:hidden;
    margin-bottom:14px;
}

.progress-bar{
    height:12px;
    background:linear-gradient(90deg,#4facfe,#00c6ff);
    width:0%;
    transition:0.3s ease;
}

/* ================= STATS ================= */

.stats{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    margin-bottom:12px;
}

.stat{
    background:var(--card);
    border-radius:14px;
    padding:10px;
    box-shadow:var(--soft-shadow);
    font-weight:600;
    font-size:13px;
    text-align:center;
}

/* ================= RAMADAN STATUS ================= */

#ramadanStatus{
    margin-top:6px;
    margin-bottom:14px;
    text-align:center;
}

/* ================= DAY GRID ================= */
.day-list{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:12px;
    margin-bottom:22px;
}

.day-item{
    border-radius:14px;
    padding:10px 12px;   /* kecilkan tinggi */
    font-size:15px;
    font-weight:500;
    height:48px;         /* FIX tinggi */
    display:flex;
    align-items:center;
    justify-content:flex-start;
}

/* LIGHT */
body:not(.dark) .day-item{
    background:#eef1f3;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
}

/* DARK */
body.dark .day-item{
    background:#1e2a30;
    box-shadow:0 4px 14px rgba(0,0,0,0.35);
}

.day-item label{
    display:flex;
    align-items:center;
    gap:8px;
}

.day-item input{
    transform:scale(1.1);
}

.locked{
    opacity:0.4;
}
/* ================= HEADLINE ================= */

.headline{
    text-align:center;
    font-weight:700;
    font-size:16px;
}

/* ================= PRAYER ================= */

.prayer-box{
    background:var(--card);
    border-radius:18px;
    padding:16px;
    box-shadow:var(--soft-shadow);
}

/* ================= QUOTE ================= */

.quote-box{
    text-align:center;
    background:var(--card);
    border-radius:18px;
    padding:16px;
    box-shadow:var(--soft-shadow);
}

.quote-category{
    display:inline-block;
    margin-bottom:6px;
    padding:4px 10px;
    font-size:11px;
    font-weight:700;
    border-radius:10px;
    background:rgba(0,0,0,0.05);
}
/* LAILATUL CSS */
.lailatul-box h3{
    margin-bottom:12px;
    text-align:center;
    overflow:hidden;
}

.lailatul-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(80px,1fr));
    gap:8px;
}

.lailatul-item{
    padding:10px;
    border-radius:12px;
    text-align:center;
    font-weight:600;
    background:rgba(0,0,0,0.05);
}

.lailatul-item.ganjil{
    background:linear-gradient(135deg,#4facfe,#00c6ff);
    color:white;
}

body.dark .lailatul-item:not(.ganjil){
    background:#1e2a30;
}

.lailatul-item.special{
    box-shadow:0 0 12px rgba(255,215,0,0.5);
    border:2px solid gold;
}

/* DOA NIAT PUASA DAN BERBUKA PUASA */
.ramadan-arch{
    background:var(--card);
    border-radius:125px 125px 30px 30px;
    padding:28px 20px;
    margin-bottom:20px;
    border:3px solid gold;
    box-shadow:
        0 0 18px rgba(255,215,0,0.15),
        var(--soft-shadow);
    overflow:hidden;
    position:relative;
}

body.dark .ramadan-arch{
    background:rgba(255,255,255,0.06);
    border:2px solid rgba(255,215,0,0.6);
}

.arch-top{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:8px;
    padding:0 10px;
    margin-bottom:18px;
    flex-wrap:wrap;
}

.arch-tab{
  color:var(--text);
    flex:1;
    min-width:0;
    max-width:140px;
    padding:10px 8px;
    border:none;
    border-radius:14px;
    cursor:pointer;
    font-family:inherit;
    font-weight:600;
    background:rgba(0,0,0,0.05);
    transition:0.2s ease;
    text-align:center;
}
body.dark .arch-tab:not(.active){
    background:rgba(255,255,255,0.06);
    color:#d6d6d6;
}


.arch-tab.active{
    background:linear-gradient(135deg,#4facfe,#00c6ff);
    color:white;
}

.arch-content{
    text-align:center;
    transition:0.25s ease;
}

.arch-content h3{
    margin-bottom:12px;
}

.arabic{
    font-size:22px;
    line-height:1.9;
    margin-bottom:12px;
}

.latin{
    font-style:italic;
    margin-bottom:8px;
}

.arti{
    font-size:14px;
    opacity:0.85;
}
/* ================= RESPONSIVE FIX ================= */

@media (min-width:600px){
    .day-list{
        grid-template-columns:repeat(6,1fr);
    }
}

@media (min-width:900px){
    .day-list{
        grid-template-columns:repeat(8,1fr);
    }
}

    .day-list{
        grid-template-columns:repeat(auto-fill,minmax(75px,1fr));
    }

    .day-item{
        font-size:13px;
        min-height:54px;
    }

    h1{
        font-size:18px;
    }

}

</style>
</head>
<body>

<div class="container">
<div class="card lailatul-box">
    <h3>ğŸŒ™ 10 MALAM TERAKHIR</h3>
    <div class="lailatul-grid" id="lailatulGrid"></div>
</div>

<h1>PUASA 2026</h1>
<div class="ramadan-arch">

<div class="arch-top">
    <button class="arch-tab active" onclick="showNiat()">Niat Puasa</button>
    <button class="arch-tab" onclick="showDoa()">Doa Berbuka</button>
    <button class="arch-tab" onclick="showLailatul()">Lailatul Qadar</button>
</div>

    <div class="arch-content" id="archContent">
        <!-- Konten akan diganti via JS -->
    </div>
</div>
<div class="theme-toggle" id="themeToggle" onclick="toggleDarkMode()">ğŸŒ‘</div>

<div class="card" id="countdown"></div>

<div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
</div>

<div class="stats">
    <div class="stat" id="totalDone"></div>
    <div class="stat" id="percentDone"></div>
    <div class="stat" id="streak"></div>
    <div class="stat" id="remaining"></div>
</div>

<div class="card" id="ramadanStatus"></div>

<div class="day-list" id="dayList"></div>
<div class="card search-card">
    <h3>ğŸ” TEMUKAN IMSAK WILAYAH</h3>

    <div class="search-wrapper">
        <input 
            type="text" 
            id="cityInput" 
            placeholder="Masukkan nama kota..."
            onkeypress="handleEnter(event)"
        >
        <button onclick="searchCityPrayer()">Cari</button>
    </div>

    <div id="cityResult"></div>
</div>
<div class="prayer-box" id="prayerBox">
    Loading...
</div>

</div>
<script>
function handleEnter(event){
    if(event.key === "Enter"){
        searchCityPrayer();
    }
}

const totalDays = 30;
const ramadanStart = new Date(2026,1,19);

let savedData = JSON.parse(localStorage.getItem("puasaData")) || [];
savedData = [...new Set(savedData)].sort((a,b)=>a-b);

const dayList = document.getElementById("dayList");
const progressBar = document.getElementById("progressBar");
const totalDone = document.getElementById("totalDone");
const percentDone = document.getElementById("percentDone");
const streakBox = document.getElementById("streak");
const remainingBox = document.getElementById("remaining");
const countdownBox = document.getElementById("countdown");
const ramadanStatus = document.getElementById("ramadanStatus");
const prayerBox = document.getElementById("prayerBox");
const toggleBtn = document.getElementById("themeToggle");

/* ================= DARK MODE ================= */

function toggleDarkMode(){
    document.body.classList.toggle("dark");
    const isDark = document.body.classList.contains("dark");
    localStorage.setItem("darkMode", isDark);
    toggleBtn.innerText = isDark ? "ğŸ”†" : "ğŸŒ‘";
}

(function initTheme(){
    const saved = localStorage.getItem("darkMode");
    if(saved === "true"){
        document.body.classList.add("dark");
        toggleBtn.innerText="ğŸ”†";
    }
})();

/* ================= DATE ================= */

function calculateCurrentDay(){
    const now = new Date();
    const start = new Date(ramadanStart);
    start.setHours(0,0,0,0);
    return Math.floor((now - start)/(1000*60*60*24)) + 1;
}

function calculateCurrentDayWithMaghrib(maghribHour, maghribMinute){
    const now = new Date();
    const start = new Date(ramadanStart);
    start.setHours(0,0,0,0);

    const todayMaghrib = new Date();
    todayMaghrib.setHours(maghribHour, maghribMinute,0,0);

    let diffDays = Math.floor((now - start)/(1000*60*60*24)) + 1;

    if(now < todayMaghrib){
        diffDays -= 1;
    }

    return diffDays;
}

/* ================= DOA TABS ================= */

function setActiveTab(index){
    const tabs = document.querySelectorAll(".arch-tab");
    const content = document.getElementById("archContent");

    if(tabs[index].classList.contains("active")){
        tabs.forEach(t=>t.classList.remove("active"));
        content.innerHTML="";
        return false;
    }

    tabs.forEach((t,i)=>{
        t.classList.remove("active");
        if(i === index) t.classList.add("active");
    });

    return true;
}

function showNiat(){
    if(!setActiveTab(0)) return;
    document.getElementById("archContent").innerHTML = `
        <h3>ğŸŒ™ NIAT PUASA</h3>
        <p class="arabic">
        Ù†ÙÙˆÙÙŠÙ’ØªÙ ØµÙÙˆÙ’Ù…Ù ØºÙØ¯Ù Ø¹ÙÙ†Ù’ Ø£ÙØ¯ÙØ§Ø¡Ù ÙÙØ±Ù’Ø¶Ù Ø´ÙÙ‡Ù’Ø±Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ù„ÙÙ„Ù‘Ù°Ù‡Ù ØªÙØ¹ÙØ§Ù„ÙÙ‰
        </p>
        <p class="latin">
        Nawaitu shauma ghadin 'an adÄ'i fardhi syahri RamadhÄna lillÄhi ta'ÄlÄ
        </p>
        <p class="arti">
        Saya niat puasa esok hari untuk menunaikan fardhu Ramadan karena Allah Taâ€™ala.
        </p>`;
}

function showDoa(){
    if(!setActiveTab(1)) return;
    document.getElementById("archContent").innerHTML = `
        <h3>ğŸŒ… DOA BERBUKA</h3>
        <p class="arabic">
        Ø§ÙÙ„Ù„Ù‘Ù°Ù‡ÙÙ…Ù‘Ù Ù„ÙÙƒÙ ØµÙÙ…Ù’ØªÙ ÙˆÙØ¨ÙÙƒÙ Ø¢Ù…ÙÙ†Ù’ØªÙ ÙˆÙØ¹ÙÙ„ÙÙŠÙ’ÙƒÙ ØªÙÙˆÙÙƒÙ‘ÙÙ„Ù’ØªÙ ÙˆÙØ¹ÙÙ„ÙÙ‰Ù° Ø±ÙØ²Ù’Ù‚ÙÙƒÙ Ø£ÙÙÙ’Ø·ÙØ±Ù’ØªÙ
        </p>
        <p class="latin">
        Allahumma laka shumtu wa bika aamantu wa â€˜alaika tawakkaltu wa â€˜ala rizqika afthartu
        </p>
        <p class="arti">
        Ya Allah, karena-Mu aku berpuasa, kepada-Mu aku beriman, kepada-Mu aku bertawakal, dan dengan rezeki-Mu aku berbuka.
        </p>`;
}

function showLailatul(){
    if(!setActiveTab(2)) return;
    document.getElementById("archContent").innerHTML = `
        <h3>âœ¨ DOA LAILATUL QADAR</h3>
        <p class="arabic">
        Ø§Ù„Ù„Ù‘Ù°Ù‡ÙÙ…Ù‘Ù Ø¥ÙÙ†Ù‘ÙÙƒÙ Ø¹ÙÙÙÙˆÙ‘ÙŒ ØªÙØ­ÙØ¨Ù‘Ù Ø§Ù„Ø¹ÙÙÙ’ÙˆÙ ÙÙØ§Ø¹Ù’ÙÙ Ø¹ÙÙ†Ù‘ÙÙŠ
        </p>
        <p class="latin">
        Allahumma innaka 'afuwwun tuhibbul 'afwa fa'fu 'anni
        </p>
        <p class="arti">
        Ya Allah, Engkau Maha Pemaaf dan mencintai pemaafan, maka maafkanlah aku.
        </p>
        <p style="font-size:13px;opacity:0.8;">ğŸ’› Dibaca di 10 malam terakhir, terutama malam ganjil.</p>`;
}

/* ================= RENDER ================= */

function renderDays(currentDay){
    dayList.innerHTML="";
    for(let i=1;i<=totalDays;i++){
        const div=document.createElement("div");
        div.className="day-item";

        if(i>currentDay){
            div.classList.add("locked");
            div.innerHTML=`${i} ğŸ”’`;
        }else{
            div.innerHTML=`
            <label>
            <input type="checkbox" ${savedData.includes(i)?"checked":""}>
            ${i}
            </label>`;
            div.querySelector("input")
               .addEventListener("change",()=>toggleDay(i));
        }
        dayList.appendChild(div);
    }
}

function toggleDay(day){
    if(savedData.includes(day)){
        savedData=savedData.filter(d=>d!==day);
    }else{
        savedData.push(day);
    }
    savedData.sort((a,b)=>a-b);
    localStorage.setItem("puasaData",JSON.stringify(savedData));
    updateStats();
}

function updateStats(){
    const done=savedData.length;
    const percent=Math.round((done/totalDays)*100);
    const remaining=totalDays-done;

    progressBar.style.width=percent+"%";
    totalDone.innerText="TOTAL: "+done;
    percentDone.innerText="PROGRESS: "+percent+"%";
    remainingBox.innerText="SISA: "+remaining;

    let streak=0;
    for(let i=1;i<=totalDays;i++){
        if(savedData.includes(i)) streak++;
        else break;
    }
    streakBox.innerText="STREAK: "+streak;
}

function updateCountdown(){
    const today=new Date();
    const end=new Date(ramadanStart);
    end.setDate(end.getDate()+totalDays);

    const diff=Math.ceil((end-today)/(1000*60*60*24));
    countdownBox.innerHTML=
        diff>0
        ? `<div class="headline">IDUL FITRI DALAM ${diff} HARI</div>`
        : `<div class="headline">SELAMAT IDUL FITRI</div>`;
}

/* ================= PRAYER ================= */

async function getPrayerTimes(){
    try{
        const timestamp=Math.floor(Date.now()/1000);
        const res=await fetch(
            `https://api.aladhan.com/v1/timings/${timestamp}?latitude=-7.2575&longitude=112.7521&method=20`
        );
        const data=await res.json();
        if(!data.data) return;

        const t=data.data.timings;

        prayerBox.innerHTML=`
        <h3>JADWAL SHOLAT SURABAYA</h3>
        <p>IMSAK : ${t.Imsak}</p>
        <p>SUBUH : ${t.Fajr}</p>
        <p>DZUHUR : ${t.Dhuhr}</p>
        <p>ASHAR : ${t.Asr}</p>
        <p>MAGHRIB : ${t.Maghrib}</p>
        <p>ISYA : ${t.Isha}</p>`;

        const maghribRaw=t.Maghrib.split(" ")[0];
        const [h,m]=maghribRaw.split(":").map(Number);

        const now=new Date();
        const maghribTime=new Date();
        maghribTime.setHours(h,m,0,0);

        const currentDay=calculateCurrentDayWithMaghrib(h,m);
        const lastChecked=localStorage.getItem("lastAutoCheck");

        if(
            now>=maghribTime &&
            currentDay>=1 &&
            currentDay<=totalDays &&
            lastChecked!=currentDay
        ){
            if(!savedData.includes(currentDay)){
                savedData.push(currentDay);
                savedData.sort((a,b)=>a-b);
                localStorage.setItem("puasaData",JSON.stringify(savedData));
            }
            localStorage.setItem("lastAutoCheck",currentDay);
            renderDays(currentDay);
            updateStats();
        }

    }catch(err){
        console.error("Prayer API Error:",err);
    }
}

async function searchCityPrayer(){
    const city=document.getElementById("cityInput").value.trim();
    const resultBox=document.getElementById("cityResult");

    if(!city){
        resultBox.innerHTML="Masukkan nama kota dulu bro.";
        return;
    }

    resultBox.innerHTML="Mencari jadwal...";

    try{
        const res=await fetch(
            `https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Indonesia&method=20`
        );
        const data=await res.json();

        if(data.code!==200){
            resultBox.innerHTML="Kota tidak ditemukan.";
            return;
        }

        const t=data.data.timings;
        resultBox.innerHTML=`
        <strong>${city.toUpperCase()}</strong><br><br>
        IMSAK : ${t.Imsak}<br>
        MAGHRIB : ${t.Maghrib}`;
    }catch(err){
        resultBox.innerHTML="Gagal mengambil data.";
    }
}

function renderLailatul(){
    const grid=document.getElementById("lailatulGrid");
    grid.innerHTML="";
    for(let i=21;i<=30;i++){
        const div=document.createElement("div");
        div.className="lailatul-item";
        if(i%2!==0) div.classList.add("ganjil");
        if(i===27) div.classList.add("special");
        div.innerText="Malam "+i;
        grid.appendChild(div);
    }
}

/* ================= INIT ================= */

function init(){
    const currentDay=calculateCurrentDay();

    if(currentDay<1){
        ramadanStatus.innerHTML="RAMADAN BELUM DIMULAI";
    }else if(currentDay<=totalDays){
        ramadanStatus.innerHTML="HARI KE-"+currentDay+" RAMADAN";
    }else{
        ramadanStatus.innerHTML=`<div class="headline">SELAMAT IDUL FITRI</div>`;
    }

    renderDays(currentDay);
    updateStats();
    updateCountdown();
    getPrayerTimes();
    renderLailatul();

    setInterval(getPrayerTimes,60000);
}

init();
</script>

</body>
</html>
